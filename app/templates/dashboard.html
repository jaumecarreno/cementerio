{% extends "base.html" %}
{% set active_global = 'dashboard' %}
{% block title %}{{ t('menu.dashboard') }}{% endblock %}
{% block content %}
<h1 class="page-title">{{ t('menu.dashboard') }}</h1>

<div class="dashboard-top-actions">
  <a class="btn primary" href="{{ url_for('cemetery.expedientes', create_tipo='INHUMACION') }}">Nova inhumaci&oacute;</a>
  <a class="btn primary" href="{{ url_for('cemetery.expedientes', create_tipo='EXHUMACION') }}">Nova exhumaci&oacute;</a>
  <a class="btn" href="{{ url_for('cemetery.search_graves') }}">Buscar</a>
</div>

<div class="box">
  <h3>Activitat recent</h3>
  {% if data.recent_activity_by_titular %}
  <div class="activity-groups">
    {% for group in data.recent_activity_by_titular %}
    <div class="activity-group">
      <h4>{{ group.titular }}</h4>
      <table>
        <thead>
          <tr>
            <th>{{ t('dashboard.date') }}</th>
            <th>{{ t('dashboard.change') }}</th>
            <th>{{ t('cem.graves') }}</th>
            <th>{{ t('dashboard.detail') }}</th>
          </tr>
        </thead>
        <tbody>
          {% for item in group.movements %}
          <tr>
            <td>{{ item.fecha.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ item.tipo }}</td>
            <td>{{ item.sepultura }}</td>
            <td>{{ item.detalle }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="muted">{{ t('dashboard.no_recent_activity') }}</p>
  {% endif %}
</div>

<div class="panel-grid">
  <div class="box">
    <h3>Resumen</h3>
    <div class="kpi-metrics">
      <div class="kpi-row">
        <span>Expedientes abiertos</span>
        <span class="value">{{ data.kpis.expedientes_abiertos }}</span>
      </div>
      <div class="kpi-row">
        <span>OT pendientes</span>
        <span class="value">{{ data.kpis.ot_pendientes }}</span>
      </div>
      <div class="kpi-row">
        <span>Tiquets impagados</span>
        <span class="value">{{ data.kpis.tiquets_impagados }}</span>
      </div>
      <div class="kpi-row">
        <span>Pend. notificar</span>
        <span class="value">{{ data.kpis.pendientes_notificar }}</span>
      </div>
    </div>
  </div>
  <div class="box">
    <h3>{{ t('dashboard.alerts') }}</h3>
    <ul>
      {% for alert in data.alerts %}
      <li>{{ alert }}</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}

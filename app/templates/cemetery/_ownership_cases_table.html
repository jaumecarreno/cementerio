<div class="box">
  <table>
    <thead>
      <tr>
        <th>{{ t('ownership.case_number') }}</th>
        <th>{{ t('field.type') }}</th>
        <th>{{ t('field.status') }}</th>
        <th>{{ t('ownership.contract_grave') }}</th>
        <th>{{ t('ownership.previous_new_holder') }}</th>
        <th>{{ t('field.opened') }}</th>
        <th>{{ t('field.assigned') }}</th>
        <th>{{ t('common.actions') }}</th>
      </tr>
    </thead>
    <tbody>
      {% for case in rows %}
      {% set ns = namespace(prev='-', new='-') %}
      {% for party in case.parties %}
        {% if party.role.value in ['CAUSANT', 'ANTERIOR_TITULAR'] %}
          {% set ns.prev = party.person.full_name %}
        {% endif %}
        {% if party.role.value == 'NUEVO_TITULAR' %}
          {% set ns.new = party.person.full_name %}
        {% endif %}
      {% endfor %}
      <tr>
        <td>{{ case.case_number }}</td>
        <td>{{ case.type.value }}</td>
        <td>{{ case.status.value }}</td>
        <td>
          C{{ case.contract_id }}
          {% if case.contract and case.contract.sepultura %}
          / {{ case.contract.sepultura.location_label }}
          {% endif %}
        </td>
        <td>{{ ns.prev }} -> {{ ns.new }}</td>
        <td>{{ case.opened_at.date() }}</td>
        <td>{{ case.assigned_to.full_name if case.assigned_to else '-' }}</td>
        {% set primary_href = url_for('cemetery.ownership_case_detail_page', case_id=case.id) %}
        {% set primary_label = t('common.open') %}
        {% set primary = false %}
        {% set primary_icon = 'open' %}
        {% set secondary_href = '' %}
        {% set secondary_label = '' %}
        {% include "cemetery/_action_cell.html" %}
      </tr>
      {% else %}
      <tr><td colspan="8">{{ t('ownership.no_cases') }}</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>

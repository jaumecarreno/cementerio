<!-- Spec 9.0 + mockups_v2/page-2 - Panel de trabajo Cementerio -->
{% extends "base.html" %}
{% set active_global = 'cemetery' %}
{% set active_cem = 'panel' %}
{% block title %}{{ t('menu.cemetery') }}{% endblock %}
{% block content %}
<h1 class="page-title">{{ t('menu.cemetery') }}</h1>
<div class="box">
  <h3>{{ t('panel.recent_activity') }}</h3>
  {% if data.recent_activity_by_titular %}
  <div class="activity-groups">
    {% for group in data.recent_activity_by_titular %}
    <div class="activity-group">
      <h4>{{ group.titular }}</h4>
      <table>
        <thead>
          <tr>
            <th>{{ t('dashboard.date') }}</th>
            <th>{{ t('dashboard.change') }}</th>
            <th>{{ t('cem.graves') }}</th>
            <th>{{ t('dashboard.detail') }}</th>
          </tr>
        </thead>
        <tbody>
          {% for item in group.movements %}
          <tr>
            <td>{{ item.fecha.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ item.tipo }}</td>
            <td>{{ item.sepultura }}</td>
            <td>{{ item.detalle }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <p class="muted">{{ t('dashboard.no_recent_activity') }}</p>
  {% endif %}
</div>

<div class="panel-grid">
  <div class="box">
    <h3>{{ t('common.summary') }}</h3>
    <div class="kpi-metrics">
      <div class="kpi-row">
        <span>{{ t('dashboard.open_cases') }}</span>
        <span class="value">{{ data.kpis.expedientes_abiertos }}</span>
      </div>
      <div class="kpi-row">
        <span>{{ t('dashboard.pending_work_orders') }}</span>
        <span class="value">{{ data.kpis.ot_pendientes }}</span>
      </div>
      <div class="kpi-row">
        <span>{{ t('dashboard.unpaid_tickets') }}</span>
        <span class="value">{{ data.kpis.tiquets_impagados }}</span>
      </div>
      <div class="kpi-row">
        <span>{{ t('dashboard.pending_notify') }}</span>
        <span class="value">{{ data.kpis.pendientes_notificar }}</span>
      </div>
    </div>
  </div>
  <div class="box">
    <h3>{{ t('dashboard.alerts') }}</h3>
    <ul>
      {% for alert in data.alerts %}
      <li>{{ alert }}</li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endblock %}

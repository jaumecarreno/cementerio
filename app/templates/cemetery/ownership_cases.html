{% extends "base.html" %}
{% set active_cem = 'titularidad' %}
{% block title %}{{ t('ownership.title') }}{% endblock %}
{% block content %}
<h1 class="page-title">{{ t('ownership.title') }}</h1>

<div class="box">
  <h3>{{ t('ownership.start_transfer') }}</h3>
  <form method="post" action="{{ url_for('cemetery.ownership_cases') }}">
    <div class="form-grid">
      <div>
        <label>{{ t('field.contract') }}</label>
        <input type="number" name="contract_id" min="1" required>
      </div>
      <div>
        <label>{{ t('field.type') }}</label>
        <select name="type" required>
          {% for type in OwnershipTransferType %}
          <option value="{{ type.value }}">{{ type.value }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>{{ t('field.date') }} provisional</label>
        <input type="date" name="provisional_start_date">
      </div>
      <div>
        <label>{{ t('field.notes') }}</label>
        <input type="text" name="notes">
      </div>
    </div>
    <div class="actions-row">
      <button class="btn primary" type="submit">{{ t('common.create') }} {{ t('cases.title')|lower }}</button>
    </div>
  </form>
</div>

<div class="box">
  <h3>{{ t('common.filter') }}s</h3>
  <form
    method="get"
    action="{{ url_for('cemetery.ownership_cases') }}"
    hx-get="{{ url_for('cemetery.ownership_cases') }}"
    hx-target="#ownership-cases-table"
    hx-swap="innerHTML"
  >
    <div class="form-grid">
      <div>
        <label>{{ t('field.type') }}</label>
        <select name="type">
          <option value="">{{ t('search.all') }}</option>
          {% for type in OwnershipTransferType %}
          <option value="{{ type.value }}" {% if filters.type == type.value %}selected{% endif %}>{{ type.value }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>{{ t('field.status') }}</label>
        <select name="status">
          <option value="">{{ t('search.all') }}</option>
          {% for status in OwnershipTransferStatus %}
          <option value="{{ status.value }}" {% if filters.status == status.value %}selected{% endif %}>{{ status.value }}</option>
          {% endfor %}
        </select>
      </div>
      <div>
        <label>{{ t('field.from') }}</label>
        <input type="date" name="opened_from" value="{{ filters.opened_from }}">
      </div>
      <div>
        <label>{{ t('field.to') }}</label>
        <input type="date" name="opened_to" value="{{ filters.opened_to }}">
      </div>
      <div>
        <label>{{ t('field.contract') }}</label>
        <input type="text" name="contract_id" value="{{ filters.contract_id }}">
      </div>
      <div>
        <label>{{ t('field.grave') }} ID</label>
        <input type="text" name="sepultura_id" value="{{ filters.sepultura_id }}">
      </div>
      <div>
        <label>{{ t('field.holder') }} (actual/nuevo)</label>
        <input type="text" name="party_name" value="{{ filters.party_name }}">
      </div>
    </div>
    <div class="actions-row">
      <a class="btn" href="{{ url_for('cemetery.ownership_cases') }}">{{ t('common.clear') }}</a>
      <button class="btn primary" type="submit">{{ t('common.filter') }}</button>
    </div>
  </form>
</div>

<div id="ownership-cases-table">
  {% include "cemetery/_ownership_cases_table.html" %}
</div>
{% endblock %}
